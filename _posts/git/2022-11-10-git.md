---
layout: post
title: "git"
subtitle: "synthesis"
date: 2022-11-10
author: "MAI Minh"
header-img: "img/"
header-style: text
tags: [git]
catalog: true
permalink: /distilled/git.html
katex: true
mathjax: true
---



[git best pratice](../git/git-best-pratice)

## Terms

- master (branch): Git will not create a master branch until you commit something.
- HEAD: <https://initialcommit.com/blog/what-is-git-head>
- ref: a human readable name that references a Git commit ID. A ref is essentially a pointer to a commit.
- unstage --> untrack
- git rm --> delete, remove nó trên cả staging area, cũng như file system

```txt
--staged
```

HEAD: the "current branch
```bash
cat .git/HEAD
# we can HEAD==current branch
git push origin HEAD
```

### Status of a file
`git status`
- <span style="color:red">untracked</span>
- tracked
    - unchanged (not show)
    - <span style="color:green">staged</span>
    - <span style="color:red">unstaged</span>

## Commit

### Preparing for a commit
```txt
1.
git status
2.
git diff <file>
git add rm <file>
git rm <file>
git reset HEAD <file>
3.
git commit -m <msg>
```

- check `git status` for showing the working tree status
- check changes from tracked files by `git diff <file>`
- check all tracked/ untracked files wanted to `git add <file>` or `git rm <file>`
- unstage a file for this commit `git reset HEAD <file>` or `git reset <file>`, may be we dont want to add it anymore `echo <file> >> .gitignore`
- `git status` to recheck all changed file (green) to be committed and then `git commit -m <msg`>, see [how to write a commit message](../git-commit-message)
- uncommit: git reset

[git commit --amend](../git/git---amend)


### Uncommit 

To keep the changes from the commit you want to undo

```git
git reset --soft HEAD^
```

To destroy the changes from the commit you want to undo

```git
git reset --hard HEAD^
```

Đôi khi chúng ta phải tốn khá nhiều thời gian để nhận ra rằng mình đang đi sai hướng, và đến lúc đó thì không ít thay đổi đã được áp dụng. Đấy là lúc mà git reset trở nên có ích:
- `git reset HEAD~2        # undo last two commits, keep changes`
- `git reset --hard HEAD~2 # undo last two commits, discard changes`
- `git reset <commit_id>`: khi ta muon di chuyen HEAD den commit reset va giu nguyen tat ca thay doi cua file den vi tri hien tai. Tuy nhien se loai bo thay doi khoi stage
- `git reset --hard <commit_id>`: khi no van di chuyen HEAD den commit reset nhung se loai bo tat ca thay doi cua file sau commit reset
- `git reset --soft <commit_id>`: khi muon di chuyen HEADden commit reset va co nhung uu diem la se giu nguyen tat ca thay doi cua file va cac thay doi o stage. --> vi vay reset --soft duoc khuyen khich su dung hon, tuy vay, ban cung nen tuy chon voi hoan canh va muc dich ban mong muon.
Hãy cẩn thận với option --hard! Nó sẽ reset hệ thống bạn làm việc, cũng như tất cả các thay đổi cũng sẽ bị mất đi luôn.

### Unstage

```git
git add A
git diff A # nothing here
git reset HEAD A
git reset --hard origin/master
git diff A # see diff things
```

### Remove một file khỏi git mà không phải remove nó khỏi file system
Nếu bạn không cẩn thận khi dùng `git add`, bạn sẽ add một mớ file không mong muốn vào mà không hay biết. 

Tuy nhiên, `git rm` sẽ remove nó trên cả `staging area`, cũng như `file system` của bạn – một điều không ai mong muốn. 

Trong trường hợp này, hãy đảm bảo rằng bạn chỉ **remove bản staged** thôi, và **add file vào `.gitignore` để tránh lặp lại lỗi lần hai**:
```git
git reset filename          # or git remove --cached filename
echo filename >> .gitignore # add it to .gitignore to avoid re-adding it
```


## Push

> push by job, task, feature, not push by time.

### Preparing for a push

- showing all local commit (unpushed) `git log origin/master..HEAD`
- git diff origin/master..HEAD


### Pull request

```bash
# Fork the repos that you want to create a pull request

# clone this fork repos on local
git clone https://github.com/maiminh1996/Auto-Depth.git

# make some changes 

# create own work branch
git checkout -b new_branch

# Then push
git add .
git commit -m 'xxx'
git push origin new_branch

# Finally go to https://github.com/maiminh1996/Auto-Depth.git 
# and click on the pull request button
```



### To log
- `git log`
- `git diff <commit-adr>`




## Pull fetch merge
[Why does Git say my master branch is “already up to date” even though it is not?](https://stackoverflow.com/questions/15376241/why-does-git-say-my-master-branch-is-already-up-to-date-even-though-it-is-not/15381342)

pull = fetch + merge

## Update fork repos

```bash
# Add the remote, call it "upstream":
git remote add upstream https://github.com/whoever/whatever.git

# Check
git remote -vv
# this show:
origin	https://github.com/maiminh1996/whatever.git (fetch)
origin	https://github.com/maiminh1996/whatever.git (push)
upstream	https://github.com/whoever/whatever.git (fetch)
upstream	https://github.com/whoever/whatever.git (push)

# Fetch all the branches of that remote into remote-tracking branches
git fetch upstream

# Make sure that you're on your master branch:
git checkout master

# Rewrite your master branch so that any commits of yours that
# aren't already in upstream/master are replayed on top of that
# other branch:
git rebase upstream/master

# push 
git push origin master --force
```


## Branch

### Working with branch

- `git branch --list`: show all branches
- `git checkout <branch>`: switch to work on the `<branch>`
- `git branch -d <branch>`: delete a branch


```git
git branch --list
git checkout branch_name
# create new branch
git branch new_branch
# delete a branch
git branch -d name_branch
# make change in branch
touch test_branch.py # this will create file in all branch
git add test_branch.py
git commit -m '1st commit' # make file exit only in this branch
```

### stash

> saving locally tracked changes in stack form


- on a branch, all uncommited actions (git rm, touch, etc) will apply to all branches even master. After commit, these changes remain on the branch. So without risk, we do:

```
0. check branch
git branch
git stash
1. go to the working branch
git checkout <dev-br>
2. check stash work
git stash list # from all branches 
2. do some changes
3. go to master
git stash # this avoids risks
git check out master
```


when we're working on a branch and want to switch to another branch, we need to checkout and commit the changement.

However, we want to save it and not commit it, what we need to do: `git stash`

git stash list

git stash show

git stash pop stash@{1} 

git diff stash@{1}


git stash apply

git diff --name-only --diff-filter=U --relative: list all conflict files


## Merge

### Merge B to A. A la duoc cong huong, B ko thay doi. a in main in github
```git
git merge A B 
git log origin/A
git push origin A


## merge vs rebase
https://topdev.vn/blog/merge-vs-rebase-trong-git/

## rebase

`git checkout <branch>`
`git fetch <remote-name>`
`git rebase master`
```

## Remote

- adding a remote named `<name>` for the repository at `<url>`: `git add <name> <url>`
- working on existing remotes:
    - show all remotes `git remote -v`
    - remove `git remote remove origin`
    - rename `git remote rename <new-name> <current-name>`




See all last commits:
```bash
git log --stat
```
Using git gui
```bash
gitk
```



### others 
- **hooks**: pre-commit (format code, static analysis)
- **annotate/blame**: to see who write each line of code
- **cherry pick**: merge with fewer commits <!-- - **cherry pick**. Khi dùng câu lệnh git merge để hợp nhất hai nhánh lại làm một, ta sẽ mang tất cả commit của nhánh tính năng vào nhánh chính. Tuy nhiên, không phải lúc nào ta cũng muốn làm vậy, chẳng hạn như khi cần deploy và test trước một số thay đổi chọn lọc từ nhánh tính năng. Đây là lúc ta sử dụng đến câu lệnh cherry-pick để copy thay đổi từ những commit cần thiết sang một nhánh khác. Đơn vị nhỏ nhất có thể cherry pick là một commit, nên nếu commit quá lớn thì ta sẽ không thể chọn ra những thay đổi cần thiết. -->
- **submodule**, **stash**, **rebase**


<!-- Tìm hiểu thêm về Git
- Giới thiệu tổng quan về các tính năng của Git: https://git-scm.com/about.
- Tài liệu trên trang web chính thức của Git: https://git-scm.com/doc.
- Hướng dẫn sử dụng Git: https://www.atlassian.com/git/tutorials.
- Khoá học về Git trên Codecademy: https://www.codecademy.com/learn/learn-git.
- Git cheatsheet: https://ndpsoftware.com/git-cheatsheet.html.

git advance: https://topdev.vn/blog/10-van-de-ve-git-thuong-gap-va-giai-phap/ -->

### References